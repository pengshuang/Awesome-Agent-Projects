# 数据可视化功能使用指南

## 功能概述

AI 数据分析助手现在支持数据可视化功能! 您可以将查询结果通过多种图表类型进行可视化展示。

## 使用步骤

### 1. 准备数据

首先需要在系统中注册数据源并执行查询:

1. 在「⚙️ 系统设置」页面初始化系统
2. 在「🗄️ 数据源管理」页面注册数据库或文件
3. 在「💬 对话分析」页面执行数据查询

**示例查询**:
```
请查询每个月的总销售额
```

### 2. 加载数据到可视化

1. 切换到「📊 数据可视化」标签页
2. 点击「🔄 加载数据」按钮
3. 系统会显示最后一次查询的结果数据

### 3. 配置图表

在左侧配置区域:

- **图表类型**: 选择合适的图表类型
  - 柱状图: 适合分类对比
  - 折线图: 适合趋势分析
  - 散点图: 适合相关性分析
  - 饼图: 适合占比分析
  - 面积图: 适合累积趋势
  - 箱线图: 适合分布分析

- **X轴**: 选择分类或时间列
- **Y轴**: 选择数值列
- **颜色分组**: 可选,按某列分组显示

### 4. 生成图表

点击「🎨 生成图表」按钮,图表将显示在右侧区域。

## 示例场景

### 场景 1: 月度销售趋势

**查询**: "查询每个月的总销售额"

**可视化配置**:
- 图表类型: 折线图
- X轴: date (月份)
- Y轴: total_revenue (总销售额)

### 场景 2: 产品销量对比

**查询**: "查询每个产品的总销量"

**可视化配置**:
- 图表类型: 柱状图
- X轴: product (产品名称)
- Y轴: total_quantity (总销量)

### 场景 3: 产品销售占比

**查询**: "查询每个产品的销售额"

**可视化配置**:
- 图表类型: 饼图
- X轴: product (产品名称)
- Y轴: revenue (销售额)

### 场景 4: 分类销售趋势

**查询**: "查询每个月每个产品的销售额"

**可视化配置**:
- 图表类型: 折线图
- X轴: date (月份)
- Y轴: revenue (销售额)
- 颜色分组: product (产品名称)

## 快速开始

### 创建示例数据库

运行以下命令创建测试数据库:

```bash
python data/create_example_db.py
```

### 注册数据库

在「数据源管理」页面注册:
- 数据库名称: `sales_db`
- 数据库路径: `data/databases/sales_example.db`

### 示例查询

尝试以下查询:

1. **月度趋势**:
   ```
   查询每个月的总销售额,按月份排序
   ```

2. **产品对比**:
   ```
   查询每个产品的销量和销售额
   ```

3. **详细数据**:
   ```
   显示所有销售记录
   ```

## 技术特性

- **自动数据提取**: 系统会自动从SQL查询结果中提取数据
- **交互式图表**: 基于 Plotly 的交互式图表,支持缩放、悬停等操作
- **多图表类型**: 支持 6 种常用图表类型
- **实时预览**: 修改配置后立即生成新图表
- **数据表格**: 同时显示原始数据表格

## 注意事项

1. **数据要求**: 
   - 确保查询返回的数据包含数值列用于可视化
   - X轴通常选择分类或时间列
   - Y轴应选择数值列

2. **图表选择**:
   - 时间序列数据: 优先使用折线图或面积图
   - 分类数据: 优先使用柱状图
   - 占比分析: 使用饼图
   - 相关性分析: 使用散点图

3. **性能考虑**:
   - 大数据集建议先在查询时进行聚合
   - 避免可视化超过1000行的原始数据

## 故障排除

### 问题: 显示"暂无查询数据"

**解决方案**:
1. 确保已在「对话分析」中执行了数据查询
2. 查询必须返回表格数据(通常是SQL查询)
3. 点击「🔄 加载数据」重新加载

### 问题: 图表显示异常

**解决方案**:
1. 检查X轴和Y轴列的选择是否正确
2. Y轴应选择数值类型的列
3. 尝试更换图表类型

### 问题: 列选项为空

**解决方案**:
1. 先点击「🔄 加载数据」
2. 确保查询返回了有效的表格数据

## 未来功能

计划添加的功能:
- [ ] 更多图表类型(热力图、雷达图等)
- [ ] 图表导出功能(PNG, PDF)
- [ ] 自定义图表样式
- [ ] 多图表对比视图
- [ ] 数据筛选和转换

## 反馈

如有问题或建议,请查看项目文档或提交 Issue。
