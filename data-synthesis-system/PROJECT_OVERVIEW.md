# Multi-Agent 数据合成系统

## 🎯 项目概览

Multi-Agent 数据合成系统是一个创新的训练数据生成工具，专为大模型 Pretrain 和 SFT 设计。通过三个智能体（提议者、求解者、验证者）的紧密协作，系统能够自动生成高质量、高难度的长文问答数据。

### 核心创新：Iterative Curriculum Learning

系统采用独特的"迭代课程"机制：
1. **首轮生成简单的"种子问题"**
2. **每轮基于历史生成更难的新问题**
3. **问题难度和复杂度自然递增**
4. **避免重复模式，确保多样性**

这解决了传统数据合成中"只有简单检索，缺乏深度推理"的核心痛点。

---

## 📦 快速开始

### 一键启动

```bash
# 1. 配置 API Key
cp .env.example .env
# 编辑 .env，填入你的 API Key

# 2. 启动系统
./start.sh

# 3. 浏览器访问
# http://localhost:7860
```

### 5分钟生成第一个数据集

1. 上传文档或粘贴文本
2. 选择任务类型（逻辑推理/数值计算/信息查询/总结摘要）
3. 设置迭代次数（建议5-10次）
4. 点击"开始合成"
5. 下载生成的 JSON 数据

详见 [快速开始指南](QUICKSTART.md)

---

## ✨ 主要特性

### 🤖 Multi-Agent 协作

| Agent | 职责 | 工作内容 |
|-------|------|----------|
| **提议者** | 生成问题 | 基于文档和历史生成新问答对 |
| **求解者** | 尝试回答 | 模拟真实场景，检验问题可解性 |
| **验证者** | 质量检验 | 确保答案准确，只保留高质量数据 |

### 📈 Iterative Curriculum

```
迭代 1: 简单问题（基础事实查询）
  ↓ 加入历史
迭代 2: 中等难度（需要整合信息）
  ↓ 加入历史  
迭代 3: 困难问题（需要多步推理）
  ↓ 加入历史
...持续递增难度
```

### 🎯 四大任务类型

1. **逻辑推理类**: 因果分析、演绎归纳、观点论证
2. **数值计算类**: 数学运算、数据分析、统计推导
3. **信息查询类**: 信息检索、多源整合、事实查询
4. **总结摘要类**: 内容概括、要点提炼、核心总结

### ✅ 质量保证

- ✓ 求解者验证：问题必须可解
- ✓ 验证者检验：答案必须准确
- ✓ 历史参考：避免重复模式
- ✓ 难度递增：确保挑战性

---

## 🏗️ 技术架构

### 技术栈

- **LangGraph**: 多智能体工作流编排
- **LangChain**: LLM 调用和管理
- **OpenAI SDK**: 兼容多种 LLM API
- **Pydantic**: 数据验证和解析
- **Gradio**: 现代化 Web UI
- **Loguru**: 完备的日志系统

### 架构图

```
┌──────────────────────────────────────────────────┐
│                  Gradio Web UI                   │
│            (美观、实时展示、易操作)                │
└─────────────────┬────────────────────────────────┘
                  │
┌─────────────────▼────────────────────────────────┐
│              LangGraph State Machine             │
│                                                   │
│  propose → solve → validate → update             │
│     ↑                             ↓              │
│     └──────── continue ───────────┘              │
│                                                   │
│  智能循环，自动终止条件                           │
└─────────────────┬────────────────────────────────┘
                  │
┌─────────────────▼────────────────────────────────┐
│              Three Agents                        │
│  ┌─────────────────────────────────────────┐    │
│  │ ProposerAgent  | SolverAgent  | Validator│   │
│  │   (提议者)     |   (求解者)   | (验证者)  │   │
│  └─────────────────────────────────────────┘    │
└─────────────────┬────────────────────────────────┘
                  │
┌─────────────────▼────────────────────────────────┐
│          LangChain + OpenAI SDK                  │
│      (统一接口，支持多种 LLM 提供商)              │
└──────────────────────────────────────────────────┘
```

---

## 📊 使用场景

### 1. 大模型预训练数据

生成高质量的长文问答数据，用于：
- 提升模型的推理能力
- 增强长上下文理解
- 改善指令跟随能力

### 2. SFT 微调数据

针对特定领域生成专业问答：
- 法律、医疗、金融等专业领域
- 技术文档理解
- 知识库问答系统

### 3. 评估数据集

生成有挑战性的测试数据：
- 评估模型的推理深度
- 测试长文理解能力
- 对比不同模型性能

### 4. 教育和培训

生成教学问答对：
- 课程内容理解测试
- 考试题库生成
- 知识点巩固练习

---

## 📈 性能指标

### 数据质量

- **通过率**: 60-80%（验证通过的问答对比例）
- **难度递增**: 后续问题比前面的平均难 20-30%
- **多样性**: 避免重复模式，每个问题独特

### 生成效率

| 迭代次数 | 有效问答对 | 预计耗时 |
|---------|-----------|---------|
| 5 次 | 3-4 个 | 3-5 分钟 |
| 10 次 | 6-8 个 | 6-10 分钟 |
| 15 次 | 10-12 个 | 10-15 分钟 |

### 成本估算

- 每次迭代 ≈ 3 次 LLM 调用
- 每次调用 ≈ 1500 tokens（平均）
- 10 次迭代 ≈ 45,000 tokens

---

## 📖 文档导航

- 📘 **[快速开始](QUICKSTART.md)** - 5分钟上手指南
- 📗 **[用户指南](docs/USER_GUIDE.md)** - 详细使用说明
- 📙 **[开发指南](docs/DEVELOPER_GUIDE.md)** - 二次开发文档
- 📕 **[项目结构](docs/STRUCTURE.md)** - 代码结构说明

---

## 🎨 界面预览

### Web UI 特性

- ✨ 现代化设计，美观大方
- 📊 实时展示生成过程
- 📝 Markdown 格式渲染
- 💾 一键下载 JSON 结果
- 📋 详细的状态信息
- 🔄 支持文件上传和文本输入

### CLI 工具

支持命令行批量处理：

```bash
# 基本使用
python cli.py -i document.md -t logical -n 10

# 从管道输入
cat doc.txt | python cli.py -t numerical -n 5

# 指定输出
python cli.py -i doc.md -t query -o results.json
```

---

## 🔧 配置灵活

### 支持多种 LLM

```bash
# OpenAI
OPENAI_API_KEY=sk-xxx
OPENAI_API_BASE=https://api.openai.com/v1

# Qwen（通义千问）
OPENAI_API_KEY=sk-xxx
OPENAI_API_BASE=https://dashscope.aliyuncs.com/compatible-mode/v1

# Kimi（月之暗面）
OPENAI_API_KEY=sk-xxx
OPENAI_API_BASE=https://api.moonshot.cn/v1

# DeepSeek
OPENAI_API_KEY=sk-xxx
OPENAI_API_BASE=https://api.deepseek.com/v1
```

### 可定制的 Prompt

所有 Agent 的 Prompt 都可以在 `config/prompts.py` 中定制，优化生成质量。

### 灵活的参数

- 迭代次数：1-20（可配置）
- 温度参数：0-2（可配置）
- 模型选择：每个 Agent 可用不同模型
- 任务类型：4 种内置，易于扩展

---

## 🌟 为什么选择这个系统？

### vs. 传统数据生成

| 特性 | 传统方法 | 本系统 |
|------|---------|--------|
| 问题难度 | 固定、简单 | 递增、有挑战 |
| 质量保证 | 人工检查 | 自动验证 |
| 多样性 | 容易重复 | 避免重复 |
| 可扩展性 | 需要重写规则 | 修改 Prompt 即可 |

### vs. 纯粹 LLM 生成

| 特性 | 单 LLM | 本系统 |
|------|--------|--------|
| 质量控制 | 无验证 | 三重检验 |
| 可解性 | 不保证 | 求解者验证 |
| 难度控制 | 随机 | 系统递增 |
| 流程管理 | 手动 | 自动化 |

---

## 🚀 快速示例

### 输入

```
文档：《人工智能发展史》（2000字）
任务类型：逻辑推理类
迭代次数：5
```

### 输出（部分）

```json
[
  {
    "question": "为什么1980年代的专家系统最终走向失败？",
    "answer": "专家系统失败主要有三个原因：1) 知识获取困难...",
    "reasoning": "这个问题需要理解专家系统的局限性和历史背景",
    "iteration": 1
  },
  {
    "question": "对比早期符号AI和现代深度学习的根本差异...",
    "answer": "根本差异在于知识表示方式：符号AI采用显式规则...",
    "reasoning": "这个问题比第一个更难，需要对比分析",
    "iteration": 3
  }
]
```

---

## 🤝 贡献

欢迎贡献！可以通过以下方式参与：

- 🐛 报告 Bug
- 💡 提出新功能建议
- 📝 改进文档
- 🔧 提交代码

---

## 📄 许可证

MIT License - 自由使用、修改和分发

---

## 🙏 致谢

感谢以下开源项目：
- [LangChain](https://github.com/langchain-ai/langchain)
- [LangGraph](https://github.com/langchain-ai/langgraph)
- [Gradio](https://github.com/gradio-app/gradio)
- [Pydantic](https://github.com/pydantic/pydantic)

---

## 📧 联系

- 📮 Issues: [GitHub Issues](your-repo-url/issues)
- 💬 Discussions: [GitHub Discussions](your-repo-url/discussions)

---

<div align="center">

**开始你的数据合成之旅！**

```bash
./start.sh
```

Made with ❤️ for the AI Community

</div>
