# 用户使用指南

**本指南面向普通用户**，介绍如何使用 AI 数据分析助手进行数据分析。

> 💡 **设计理念**：零学习成本，3 步完成数据分析

---

## 📋 目录

- [快速开始](#快速开始)
- [界面导航](#界面导航)
- [数据源管理](#数据源管理)
- [数据查询分析](#数据查询分析)
- [数据可视化](#数据可视化)
- [常见问题](#常见问题)

---

## 快速开始

### 1. 环境准备

**系统要求**
- Python 3.8+
- 任一 LLM API Key（OpenAI/DeepSeek/Qwen/Moonshot）

**安装步骤**
```bash
# 1. 克隆项目
git clone https://github.com/pengshuang/Awesome-Agent-Projects.git
cd Awesome-Agent-Projects/ai-data-analyst-system

# 2. 安装依赖（仅需一次）
pip install -r requirements.txt

# 3. 配置 API Key
cp .env.example .env
# 编辑 .env 文件，填入你的 API Key
```

### 2. 配置 LLM（选择一个）

编辑 `.env` 文件：

**Moonshot（推荐，国内速度快）**
```bash
LLM_API_KEY=sk-your-moonshot-key
LLM_API_BASE=https://api.moonshot.cn/v1
LLM_MODEL=moonshot-v1-8k
```

**DeepSeek（性价比高）**
```bash
LLM_API_KEY=sk-your-deepseek-key
LLM_API_BASE=https://api.deepseek.com/v1
LLM_MODEL=deepseek-chat
```

**OpenAI（功能最强）**
```bash
LLM_API_KEY=sk-your-openai-key
LLM_API_BASE=https://api.openai.com/v1
LLM_MODEL=gpt-3.5-turbo
```

### 3. 启动服务

```bash
python web_ui.py
```

访问 http://localhost:7860，页面自动初始化，无需手动配置。

### 4. 创建示例数据（可选）

```bash
python data/create_example_db.py
```

生成包含销售数据的示例数据库，用于快速体验。

---

## 界面导航

### 整体布局（单屏设计）

```
┌─────────────────────────────────────────────┐
│  📖 快速开始指引（顶部蓝色卡片）              │
├──────────────────┬──────────────────────────┤
│  💬 对话区域       │  📊 可视化区域            │
│  - 数据源选择      │  - 自动生成图表           │
│  - 问题输入        │  - 历史查询切换           │
│  - 对话历史        │  - 图表设置（折叠）       │
│                   │  - 数据详情（折叠）       │
├──────────────────┴──────────────────────────┤
│  ➕ 快速添加数据源（折叠面板）                │
└─────────────────────────────────────────────┘
```

### 核心功能区

1. **顶部指引** - 显示 3 步操作流程，新手友好
2. **左侧对话** - 选择数据源、输入问题、查看回复
3. **右侧可视化** - 自动显示图表和数据表格
4. **底部添加** - 快速注册新的数据源

### 关键特性

✅ **自动初始化** - 打开页面即可使用，无需点击初始化按钮  
✅ **单屏设计** - 所有功能在一个页面，无需切换标签  
✅ **自动可视化** - 查询后自动生成图表，无需手动操作  
✅ **实时更新** - 修改图表参数立即生效

---

## 数据源管理

### 添加数据源（3 步）

1. **点击底部「➕ 快速添加数据源」展开面板**
2. **填写信息**：
   - 类型：选择 SQLite数据库 / 文件(CSV/Excel) / 知识库
   - 名称：数据源的别名（如：sales_db）
   - 路径：文件或数据库的路径
3. **点击「➕ 添加」完成注册**

### 支持的数据源类型

#### 1. SQLite 数据库

**适用场景**：结构化数据，复杂查询

**添加示例**：
- 类型：`SQLite数据库`
- 名称：`sales_db`
- 路径：`data/databases/sales.db`

**查询示例**：
```
查询 2024 年每个月的销售总额
查询销售额超过 10000 的订单
```

#### 2. 文件数据源

**支持格式**：CSV, Excel (.xlsx, .xls), JSON

**添加示例**：
- 类型：`文件(CSV/Excel)`
- 名称：`products`  
- 路径：`data/files/products.csv`

**查询示例**：
```
显示产品列表
统计各类别的产品数量
```

#### 3. 知识库

**适用场景**：文档检索，语义搜索

**添加示例**：
- 类型：`知识库`
- 名称：`docs`
- 路径：`data/knowledge_base`（可留空使用默认）

**查询示例**：
```
查找关于销售政策的文档
总结产品使用指南
```

### 查看已注册数据源

在左侧「📊 数据源」下拉框中查看所有已注册的数据源。

---

## 数据查询分析

### 基本查询流程

1. **选择数据源** - 在左侧「📊 数据源」下拉框选择要查询的数据源
2. **输入问题** - 在输入框中用中文描述你想了解的内容
3. **发送查询** - 点击「📤 发送」或按 Enter 键
4. **查看结果** - 对话区显示分析结果，右侧自动生成图表

### 查询示例

#### 基础查询
```
查询所有客户信息
显示前 20 条销售记录
统计数据总行数
```

#### 条件筛选
```
查询销售额超过 5000 的订单
显示 2024 年的销售数据
查找北京地区的客户
```

#### 聚合统计
```
每个产品的总销量是多少？
按月统计销售额
哪个客户的购买金额最高？
```

#### 排序查询
```
显示销售额前 10 的产品
按价格从高到低排列商品
```

#### 多表查询（数据库）
```
查询客户及其订单信息
统计每个类别的产品数量和平均价格
```

### 高级功能

#### 多轮对话

系统支持上下文对话，可以连续提问：

```
用户：查询销售数据
助手：[显示销售数据表格]

用户：只看销售额超过 1000 的
助手：[过滤后的数据]

用户：按销售额降序排列
助手：[排序后的数据]
```

#### 直接对话（无数据源）

将数据源选为「无（直接对话）」，可以：
- 咨询数据分析方法
- 询问功能使用方法
- 获取 SQL 语法帮助

```
如何计算同比增长率？
什么是数据透视表？
```

---

## 数据可视化

### 自动可视化

查询返回数据后，右侧自动生成图表：
- 自动选择合适的图表类型（柱状图/折线图）
- 自动选择 X 轴和 Y 轴
- 显示数据表格（点击「📋 数据详情」查看）

### 手动调整图表

点击右侧「⚙️ 图表设置」展开配置面板：

1. **图表类型** - 选择柱状图、折线图、散点图、饼图、面积图
2. **X 轴** - 选择分类或时间列
3. **Y 轴** - 选择数值列
4. **颜色分组** - 可选，用不同颜色区分类别

修改后图表**实时更新**，无需点击按钮。

### 查看历史查询

右侧「📊 数据可视化」标题旁的下拉框可切换历史查询：
- 默认显示「当前查询」
- 选择历史记录自动加载数据和图表
- 最多保存 20 条查询历史

### 支持的图表类型

| 图表类型 | 适用场景 | 示例 |
|---------|---------|------|
| 柱状图 | 类别对比 | 各产品销量对比 |
| 折线图 | 趋势变化 | 每月销售额趋势 |
| 散点图 | 相关性分析 | 价格与销量关系 |
| 饼图 | 占比分析 | 各类别销售占比 |
| 面积图 | 累积趋势 | 累计销售额变化 |

---

## 常见问题

### 使用相关

**Q: 首次使用需要初始化吗？**  
A: 不需要。页面加载时自动初始化，直接使用即可。

**Q: 如何切换查看历史查询？**  
A: 右侧可视化区域标题旁有下拉框，选择即可切换。

**Q: 为什么没有自动生成图表？**  
A: 可能原因：
- 查询结果为空
- 数据列少于 2 列
- 数据类型不适合可视化
可手动在「⚙️ 图表设置」中配置。

**Q: 如何清空对话历史？**  
A: 点击左侧「🗑️ 清空」按钮。

### 配置相关

**Q: 支持哪些 LLM？**  
A: 支持所有兼容 OpenAI API 格式的服务：
- OpenAI (gpt-3.5-turbo, gpt-4)
- DeepSeek (deepseek-chat)
- 阿里通义千问 (qwen-turbo, qwen-plus)
- Moonshot (moonshot-v1-8k)

**Q: Embedding 模型如何配置？**  
A: 在 `.env` 中设置：
```bash
# 使用本地模型
EMBEDDING_PROVIDER=huggingface
EMBEDDING_MODEL=/path/to/bge-small-zh-v1.5

# 或使用 OpenAI
EMBEDDING_PROVIDER=openai
EMBEDDING_MODEL=text-embedding-3-small
```

**Q: 如何使用本地 LLM？**  
A: 需要先部署本地服务（如 Ollama、vLLM），然后配置：
```bash
LLM_API_BASE=http://localhost:11434/v1
LLM_MODEL=your-local-model
```

### 数据源相关

**Q: SQLite 数据库路径如何填写？**  
A: 
- 相对路径：`data/databases/example.db`
- 绝对路径：`/Users/username/data/example.db`

**Q: Excel 文件支持哪些格式？**  
A: 支持 `.xlsx` 和 `.xls` 格式。

**Q: CSV 文件编码问题？**  
A: 系统自动检测编码（UTF-8, GBK 等），如有问题请转换为 UTF-8。

**Q: 知识库如何使用？**  
A: 
1. 将文档（txt, md, pdf）放入 `data/knowledge_base/` 目录
2. 注册知识库数据源
3. 用自然语言提问，系统会检索相关文档

### 性能相关

**Q: 查询速度慢？**  
A: 
- 首次查询需要加载模型，稍慢是正常的
- 可更换响应更快的 LLM 服务
- 检查网络连接和 API 服务状态

**Q: 内存占用高？**  
A: 
- 本地 Embedding 模型会占用内存
- 可改用 OpenAI Embedding
- 关闭不用的数据源

---

## 提示与技巧

### 查询优化

1. **明确查询意图** - 清楚说明要查询什么
   - ✅ "查询 2024 年销售额超过 1000 的订单"
   - ❌ "查询数据"

2. **指定数量限制** - 避免返回过多数据
   - ✅ "显示前 20 条记录"
   - ✅ "统计每个类别的销量"

3. **使用具体列名** - 提高查询准确度
   - ✅ "按 create_time 排序"
   - ❌ "按时间排序"

### 可视化技巧

1. **选择合适的图表类型**
   - 对比数值 → 柱状图
   - 展示趋势 → 折线图
   - 查看占比 → 饼图

2. **合理使用颜色分组**
   - 区分类别时使用
   - 避免分组过多（超过 10 个）

3. **数据预处理**
   - 先用查询筛选和聚合数据
   - 再进行可视化

### 效率提升

1. **使用历史查询** - 避免重复查询相同数据
2. **保存常用数据源** - 一次注册，持续使用  
3. **多轮对话** - 逐步细化查询条件

---

## 故障排除

### 系统无法启动

```bash
# 检查依赖是否完整
pip install -r requirements.txt

# 检查 Python 版本
python --version  # 需要 3.8+
```

### API 调用失败

1. 检查 `.env` 配置是否正确
2. 确认 API Key 有效且有余额
3. 检查网络连接
4. 查看日志文件 `logs/` 获取详细错误

### 数据源注册失败

1. 确认文件/数据库路径正确
2. 检查文件权限
3. SQLite 数据库确保不是损坏的
4. CSV 文件确保格式正确

### 查询结果为空

1. 检查数据源是否有数据
2. 确认查询条件是否过于严格
3. 尝试简化查询语句
4. 查看对话中的 SQL 语句是否正确

---

## 进阶使用

### 自定义配置

编辑 `.env` 文件可调整更多参数：

```bash
# 对话历史保留轮数
MAX_HISTORY_TURNS=100

# 日志级别
LOG_LEVEL=INFO

# SQL 方言（用于数据库查询）
SQL_DIALECT=sqlite
```

### 数据目录结构

```
data/
├── databases/      # SQLite 数据库文件
├── files/          # CSV, Excel, JSON 文件
├── knowledge_base/ # 知识库文档
└── cache/          # 系统缓存
```

### 查看日志

```bash
# 查看最新日志
tail -f logs/app.log

# 查看错误日志
grep ERROR logs/app.log
```

---

## 获取帮助

- 📖 [开发者指南](DEVELOPER_GUIDE.md) - 二次开发参考
- 🐛 [问题反馈](https://github.com/pengshuang/Awesome-Agent-Projects/issues)
- 📧 联系作者

---

**更新日期**: 2025-12-31  
**版本**: v2.0 - 简化版界面

**趋势分析**
```
按月统计销售额趋势
对比各产品的销售情况
```

### 数据可视化

#### 方式一：对话生成

直接在对话中要求可视化：
```
查询每月销售额，并生成折线图
```

#### 方式二：手动配置

1. 切换到「📊 数据可视化」标签页
2. 选择数据源，点击「加载数据」
3. 配置图表：
   - 选择图表类型（柱状图/折线图/饼图等）
   - 设置 X 轴和 Y 轴字段
   - 设置图表标题
4. 点击「生成图表」

#### 支持的图表类型

- 📊 **柱状图** - 对比数据
- 📈 **折线图** - 趋势分析
- 🥧 **饼图** - 占比分析
- 🔵 **散点图** - 相关性分析
- 📉 **箱线图** - 分布分析
- 🌡️ **热力图** - 多维数据

### 查询示例

**销售分析**
```
查询每个月的销售额
找出销量前 5 的产品
计算每个客户的总消费金额
```

**数据筛选**
```
查询 2024 年的销售数据
显示销售额大于 1000 的订单
找出购买过笔记本电脑的客户
```

**聚合统计**
```
按产品分组统计销量和销售额
计算每月的平均订单金额
统计每个地区的客户数量
```

## 常见问题

### Q1: 提示 "LLM_API_KEY 未设置"

**解决方案**: 检查 `.env` 文件是否正确配置了 `LLM_API_KEY`

### Q2: 查询结果为空

**原因**:
- 数据源未注册
- SQL 查询条件不匹配
- 数据库中确实没有数据

**解决方案**:
1. 检查数据源是否已注册
2. 在数据源管理中查看 Schema
3. 使用更宽泛的查询条件

### Q3: 可视化失败

**原因**:
- 数据类型不匹配
- 字段名错误
- 数据量为空

**解决方案**:
1. 确保数据已正确查询
2. 检查字段名是否正确
3. 确认数据类型适合图表类型

### Q4: 对话没有上下文

**解决方案**: 
- 确保在同一会话中连续对话
- 不要刷新页面（会清空历史）
- 检查「历史轮数」设置

### Q5: 支持哪些 SQL 方言？

目前主要支持 SQLite，其他数据库（MySQL、PostgreSQL）可通过配置 `SQL_DIALECT` 环境变量。

### Q6: 如何提高查询准确性？

**建议**:
1. 使用清晰明确的问题
2. 包含具体的字段名
3. 指定时间范围等条件
4. 查看数据源 Schema 了解字段信息

### Q7: 数据安全吗？

- 所有数据在本地处理
- 只有查询问题会发送给 LLM
- 不会上传原始数据
- 建议使用只读数据库连接

## 🎯 使用技巧

1. **先了解数据结构** - 在数据源管理中查看 Schema
2. **从简单开始** - 先进行简单查询，再逐步复杂化
3. **善用示例** - 参考示例查询语句
4. **多轮对话** - 可以基于上一次结果继续提问
5. **验证结果** - 通过可视化图表验证查询结果

## 📞 获取帮助

- 查看 [开发者指南](DEVELOPER_GUIDE.md)
- 提交 [Issue](https://github.com/your-repo/issues)
- 查看示例代码 `examples/`

> 面向普通用户的安装、配置和使用教程

---

## 🚀 快速开始

### 系统要求

- Python 3.8+
- 8GB 内存（推荐）
- 稳定的网络连接

### 安装步骤

```bash
# 1. 安装依赖
pip install -r requirements.txt

# 2. 配置环境
cp .env.example .env
# 编辑 .env 文件（见下文）

# 3. 启动服务
python web_ui.py

# 4. 访问界面
# http://localhost:7860
```

---

## ⚙️ 环境配置

### 必需配置

编辑 `.env` 文件，配置 LLM API：

```bash
# LLM API 配置（必填）
LLM_API_KEY=your-api-key-here
LLM_API_BASE=https://api.openai.com/v1
LLM_MODEL=gpt-3.5-turbo
TEMPERATURE=0.1
```

### 常用 API 配置

**OpenAI**
```bash
LLM_API_KEY=sk-...
LLM_API_BASE=https://api.openai.com/v1
LLM_MODEL=gpt-3.5-turbo
```

**DeepSeek**
```bash
LLM_API_KEY=sk-...
LLM_API_BASE=https://api.deepseek.com/v1
LLM_MODEL=deepseek-chat
```

**通义千问**
```bash
LLM_API_KEY=sk-...
LLM_API_BASE=https://dashscope.aliyuncs.com/compatible-mode/v1
LLM_MODEL=qwen-turbo
```

**本地模型（Ollama）**
```bash
LLM_API_KEY=ollama
LLM_API_BASE=http://localhost:11434/v1
LLM_MODEL=llama3
```

### 可选配置

```bash
# Embedding 模型
EMBEDDING_PROVIDER=huggingface
EMBEDDING_MODEL_NAME=BAAI/bge-small-zh-v1.5

# 对话历史轮数
MAX_HISTORY_TURNS=10

# Web 搜索（可选）
ENABLE_WEB_SEARCH=false
WEB_SEARCH_API_KEY=your-search-api-key
```

---

## 📖 使用教程

### 步骤 1：初始化系统

1. 打开 http://localhost:7860
2. 切换到「⚙️ 系统设置」标签页
3. 点击「🔄 初始化系统」
4. 等待初始化完成

### 步骤 2：注册数据源

切换到「🗄️ 数据源管理」标签页

#### 注册数据库

```
数据库名称: sales_db
数据库路径: data/databases/sales.db
```

点击「➕ 注册数据库」

#### 注册文件

```
文件名称: sales_data
文件路径: data/files/sales.csv
```

支持：CSV、Excel、JSON、Parquet

#### 注册知识库

1. 将文档放入 `data/knowledge_base/`
2. 输入知识库名称
3. 点击「➕ 注册知识库」

支持：PDF、Word、Markdown、TXT

#### 启用 Web 搜索

配置 `.env` 后点击「🔌 启用Web搜索」

### 步骤 3：数据分析

切换到「💬 对话分析」标签页

#### 示例查询

**数据库查询**
```
- 统计每个月的销售总额
- 找出销售额前10的产品
- 分析2024年的销售趋势
```

**文件分析**
```
- 这个数据集有多少行？
- 分析各列的数据分布
- 找出price列的异常值
```

**知识库问答**
```
- 公司的休假政策是什么？
- 如何申请报销？
```

#### 多轮对话

```
用户: 查询销售数据
助手: [展示数据]

用户: 按地区分组
助手: [理解上下文，重新查询]

用户: 只看前5名
助手: [继续基于上下文]
```

### 步骤 4：数据可视化

1. 在「对话分析」中执行查询
2. 切换到「📊 数据可视化」标签页
3. 点击「🔄 加载数据」
4. 配置图表：
   - 选择图表类型
   - 选择 X 轴和 Y 轴
   - 可选：颜色分组
5. 点击「🎨 生成图表」

#### 图表类型选择

| 图表 | 适用场景 |
|------|---------|
| 柱状图 | 分类对比 |
| 折线图 | 趋势分析 |
| 散点图 | 相关性分析 |
| 饼图 | 占比分析 |
| 面积图 | 累积趋势 |
| 箱线图 | 分布分析 |

---

## 💡 最佳实践

### 提问技巧

✅ **好的问题**
- "查询2024年1-6月各产品的销售额，按金额降序排列"
- "分析sales表中price和quantity的相关性"
- "公司对于年假的规定是怎样的？"

❌ **不好的问题**
- "查一下"（不明确）
- "数据有问题"（没有具体描述）
- "怎么办"（缺少上下文）

### 数据源管理

- 使用有意义的名称
- 定期更新数据
- 备份重要数据

### 性能优化

- 使用快速模型（gpt-3.5-turbo）
- 限制返回数据量（使用 LIMIT）
- 减少历史轮数

---

## ❓ 常见问题

### Q: 初始化失败？

**检查清单**
- [ ] `.env` 文件配置正确
- [ ] API Key 有效
- [ ] 网络连接正常
- [ ] 查看 `logs/` 目录

### Q: SQL 生成不准确？

**解决方案**
- 提供更详细的问题描述
- 使用多轮对话逐步明确
- 检查数据库 schema 是否正确加载

### Q: 知识库没有结果？

**检查项**
- [ ] 文档已放入目录
- [ ] 文档格式支持
- [ ] 索引构建成功
- [ ] 尝试不同问法

### Q: 响应速度慢？

**优化建议**
- 使用更快的模型
- 减少 `MAX_HISTORY_TURNS`
- 限制数据量
- 使用本地 Embedding

### Q: 如何查看调试日志？

日志位置：`logs/ai_data_analyst_YYYY-MM-DD.log`

包含：
- 所有 LLM 调用的 Prompt
- 系统响应
- 错误信息

---

## 📝 示例：完整工作流

### 1. 创建示例数据库

```bash
python data/create_example_db.py
```

### 2. 注册数据源

```
数据库名称: sales_db
数据库路径: data/databases/sales_example.db
```

### 3. 查询分析

```
查询每个月的总销售额，按月份排序
```

### 4. 可视化

- 加载数据
- 图表类型：折线图
- X轴：date
- Y轴：total_revenue
- 生成图表

---

## 🔗 相关文档

- [📖 功能介绍](FEATURES.md) - 了解所有功能
- [💻 开发指南](DEVELOPER_GUIDE.md) - 二次开发
- [📊 可视化指南](VISUALIZATION_GUIDE.md) - 详细的可视化教程

---

## 📞 技术支持

- 提交 Issue 报告问题
- 查看文档获取帮助
- 参与社区讨论

### 第一步：初始化系统

1. 打开 Web 界面
2. 切换到「⚙️ 系统设置」标签页
3. 点击「🔄 初始化系统」按钮
4. 等待初始化完成

看到「✅ 系统初始化成功！」即可进入下一步。

### 第二步：注册数据源

切换到「🗄️ 数据源管理」标签页，根据需要注册不同类型的数据源：

#### 注册 SQLite 数据库

1. 输入数据库名称（例如：`sales_db`）
2. 输入数据库路径（例如：`data/databases/sales.db`）
3. 点击「➕ 注册数据库」
4. 查看返回的数据库结构信息

**示例**：
```
数据库名称：sales_db
数据库路径：/Users/username/data/sales.db
```

#### 注册文件数据源

支持的文件格式：CSV、Excel、JSON、Parquet

1. 输入文件名称（例如：`sales_data`）
2. 输入文件路径（例如：`data/files/sales.csv`）
3. 点击「➕ 注册文件」
4. 查看文件的列信息和样例数据

#### 注册知识库

1. 将文档放入 `data/knowledge_base/` 目录
2. 输入知识库名称（例如：`company_kb`）
3. 知识库目录留空（使用默认目录）或指定自定义目录
4. 点击「➕ 注册知识库」
5. 等待索引构建完成

**支持的文档格式**：
- PDF、Word、Markdown
- TXT、HTML
- 其他 LlamaIndex 支持的格式

#### 启用 Web 搜索（可选）

1. 在 `.env` 中配置 `WEB_SEARCH_API_KEY`
2. 设置 `ENABLE_WEB_SEARCH=true`
3. 点击「🔌 启用Web搜索」

### 第三步：开始分析

切换到「💬 对话分析」标签页：

#### 基础对话

1. 在「选择数据源」下拉框中选择「无（直接对话）」
2. 输入问题
3. 点击「📤 发送」

**示例问题**：
- "你好，请介绍一下你的功能"
- "什么是NL2SQL？"

#### 单数据源分析

1. 在「选择数据源」中选择已注册的数据源
2. 输入分析问题
3. 查看结果

**示例问题**（针对数据库）：
- "统计每个月的销售总额"
- "找出销售额前10的产品"
- "分析销售趋势"

**示例问题**（针对文件）：
- "这个数据集有多少行？"
- "分析各列的数据分布"
- "找出异常值"

**示例问题**（针对知识库）：
- "公司的休假政策是什么？"
- "如何申请报销？"

#### SQL 查询结果

当进行数据库查询时，系统会自动：
1. 将自然语言转换为 SQL
2. 以语法高亮的方式展示 SQL
3. 执行查询并返回结果
4. 对结果进行分析和解读

**输出示例**：
```markdown
### 生成的SQL查询

​```sql
SELECT 
    DATE_FORMAT(sale_date, '%Y-%m') as month,
    SUM(amount) as total_sales
FROM sales
GROUP BY month
ORDER BY month DESC
​```

### 分析结果

根据查询结果，2023年的销售数据显示：
- 12月销售额最高，达到 ¥850万
- 全年销售呈上升趋势
- ...
```

#### 多轮对话

系统会记住对话上下文，支持连续提问：

```
👤 用户：查询销售数据
🤖 助手：[展示销售数据]

👤 用户：按地区分组
🤖 助手：[理解上下文，按地区重新查询]

👤 用户：只看华东地区
🤖 助手：[继续基于上下文筛选]
```

### 高级功能

#### 多数据源融合分析

目前通过在提问中明确指定多个数据源来实现：

```
"结合 sales_db 数据库和 company_kb 知识库，
分析销售策略的执行效果"
```

#### 生成分析报告

在问题中明确要求生成报告：

```
"分析 sales_data 的销售情况，
生成一份包含摘要、详细分析和建议的报告"
```

#### 决策支持

```
"基于 sales_db 的数据，
应该在哪个地区加大投入？
给出数据支持和行动计划"
```

## 常见问题

### Q1：初始化失败怎么办？

**检查项**：
1. `.env` 文件是否正确配置
2. `LLM_API_KEY` 是否有效
3. 网络连接是否正常
4. 查看 `logs/` 目录下的错误日志

### Q2：SQL 生成不准确？

**解决方案**：
1. 确保数据库 schema 已正确加载
2. 提供更详细的问题描述
3. 尝试多轮对话逐步明确需求
4. 查看日志中的 Prompt，了解 LLM 的理解

### Q3：知识库查询没有结果？

**检查项**：
1. 知识库目录是否包含文档
2. 文档格式是否支持
3. 索引是否构建成功
4. 尝试用不同的问法

### Q4：响应速度慢？

**优化建议**：
1. 使用更快的 LLM 模型（如 gpt-3.5-turbo）
2. 减少历史轮数（`MAX_HISTORY_TURNS`）
3. 限制返回的数据量
4. 使用本地 Embedding 模型

### Q5：如何查看调试信息？

所有 LLM 调用的 Prompt 都会记录在日志中：
- 位置：`logs/ai_data_analyst_YYYY-MM-DD.log`
- 包含：输入 Prompt、LLM 响应、错误信息
- 用于 Debug 和优化 Prompt

## 最佳实践

### 提问技巧

1. **具体明确**：清楚说明要查询的字段、时间范围、筛选条件
2. **分步骤**：复杂分析可以分多轮完成
3. **确认理解**：不确定时可以要求系统解释
4. **提供上下文**：在多轮对话中，适当引用之前的结果

### 数据源管理

1. **命名规范**：使用有意义的数据源名称
2. **定期更新**：及时更新数据库和文件
3. **知识库维护**：定期添加新文档，删除过时内容
4. **备份数据**：重要数据定期备份

### 性能优化

1. **限制数据量**：大数据集先采样或聚合
2. **缓存结果**：相同查询可以重用结果
3. **批量处理**：相关的多个问题可以合并
4. **选择合适的模型**：根据任务复杂度选择模型

## 更新日志

查看项目的 Git 提交历史或 CHANGELOG.md 文件。

## 技术支持

- 查看[开发指南](DEVELOPER_GUIDE.md)了解技术细节
- 查看[功能介绍](FEATURES.md)了解完整功能
- 提交 Issue 报告问题或建议
